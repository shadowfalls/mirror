{"title":"Interceptors in Angular 9","description":"This blog gives you an introduction to how to use interceptors in Angular 9","categoryId":"angular_9","content":[{"html":"<a href=\"https://angular.io/api/common/http/HttpInterceptor\" title=\"https://angular.io/api/common/http/HttpInterceptor\" target=\"_blank\">Interceptors</a>&nbsp;where introduced in Angular 4 along with the powerful&nbsp;<a href=\"https://angular.io/guide/http\" title=\"https://angular.io/guide/http\" target=\"_blank\">HTTP Clients Module</a>. They come very handy when you want to perform any action before and after making a API request.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Some of the common situations where it would help is when you need to append a <b>JWT token </b>whenever making an API call to validate the user, and other situations like when receiving a 403 (Unauthorised user or JWT token has expired) or any other server errors that needs to be handled in the front-end. In this tutorial we will learn how to setup Interceptor in our Angular Application.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Prerequisites","isQuoted":false,"isGist":false,"isMainHeading":true,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"We need&nbsp;<a href=\"https://nodejs.org/dist/v8.12.0/\" title=\"https://nodejs.org/dist/v8.12.0/\" target=\"_blank\">nodejs 8.12.0</a>&nbsp;&amp; npm v6.4.1 We need Angular CLI","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"$ npm install -g angular-cli","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"It will help if you know a little bit about how to create a project using Angular CLI. If you are not familiar, you can checkout out blog on&nbsp;<a href=\"https://www.dineshmg.com/blog/Setting_up_Angular_9.html\" title=\"https://www.dineshmg.com/blog/Setting_up_Angular_9.html\" target=\"_blank\">setting up Angular 9</a>.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Create Angular Application","isQuoted":false,"isGist":false,"isMainHeading":true,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"As a quick start you can create and run an angular application by running the following commands","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"$ ng new Angular-Interceptor<div>$ cd Angular-Interceptor</div><div>$ ng serve</div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"You can open the project location in any of your favourite editor and you will find many files in it.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Adding HttpClientModule","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":true,"isCodeSection":false,"gist":""},{"html":"Open <b>app.module.ts</b>&nbsp;which will be present in <b>src/app </b>directory and import <b>HttpClientModule </b>and added it to the <b>imports</b> section of the Module. You will need this to make API calls.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Creating app.service.ts","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":true,"isCodeSection":false,"gist":""},{"html":"In your project folder create a file called <b>app.service.ts </b>and paste the following into it.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"","isQuoted":false,"isGist":true,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":"2e06ed22c725dfac4f28d9aad96c2238"},{"html":"Import <b>app.service.ts</b> into <b>app.module.ts</b>. You app.module.ts file should look like this.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"","isQuoted":false,"isGist":true,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":"f3dd43d90a5742a3c09f2fb88a0d876c"},{"html":"Creating Angular Interceptor","isQuoted":false,"isGist":false,"isMainHeading":true,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Create a file called <b>app.interceptor.ts</b> in you project and import the following.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"import { Injectable } from '@angular/core';<div>import {</div><div>&nbsp; &nbsp; HttpInterceptor,</div><div>&nbsp; &nbsp; HttpRequest,</div><div>&nbsp; &nbsp; HttpResponse,</div><div>&nbsp; &nbsp; HttpHandler,</div><div>&nbsp; &nbsp; HttpEvent,</div><div>&nbsp; &nbsp; HttpErrorResponse</div><div>} from '@angular/common/http';</div><div><br></div><div>import { Observable, throwError } from 'rxjs';</div><div>import { map, catchError } from 'rxjs/operators';</div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"In Angular 6&amp;7 rxjs map are changed to path rxjs/operators. We need to careful while importing. These are the main changes in Angular 6 and 7.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Create a class called <b>AppInterceptor</b> and implement <b>HttpInterceptor </b>and create method called <b>interceptor().&nbsp;</b>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"@Injectable()<div>export class AppInterceptor implements HttpInterceptor {<div><div>          intercept(request: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {</div><div>          }</div><div> }</div></div></div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"In this example we will be appending a sample header called <b>sample-header</b> for testing.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Within the interceptor function write the following line","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"request = request.clone({ headers: request.headers.set('sample-header', '1') });<div>return next.handle(request)</div><div>           .pipe(<span style=\"font-size: 1rem;\"> catchError((event: HttpErrorResponse) =&gt; {</span></div><div>                return throwError(event);</div><div>            }));</div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"The first line will append the header <b>sample-header</b>&nbsp;with value as <b>1</b> and the return statement will handle any errors that the server sends.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"Now our interceptor is ready. You need to import the interceptor into <b>app.module.ts&nbsp;</b>into the providers section.","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"providers: [<div>AppService,</div><div><span style=\"font-size: 1rem;\">{</span><div>    provide: HTTP_INTERCEPTORS,</div><div>    useClass: AppInterceptor,</div><div>    multi: true</div><div>}<span style=\"font-size: 1rem;\">]</span></div></div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"The final code will look like the following","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"","isQuoted":false,"isGist":true,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":"8ffdbbbc249c343f5b57afe6e0aa0ab3"},{"html":"Testing the Interceptor","isQuoted":false,"isGist":false,"isMainHeading":true,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"In order to test the interceptor write the following code in <b>app.component.ts </b>in the <b>ngOnInit()</b> function if it not already present implement by importing <b>OnInit</b> interface","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"import { Component, OnInit } from '@angular/core';<div>import { AppService } from './app.service';</div><div><br></div><div>@Component({</div><div>  selector: 'app-root',</div><div>  templateUrl: './app.component.html',</div><div>  styleUrls: ['./app.component.scss']</div><div>})</div><div>export class AppComponent implements OnInit {</div><div>  title = 'angular-interceptor';</div><div><br></div><div>  constructor(</div><div>    private appService: AppService</div><div>  ) { }</div><div><br></div><div>  ngOnInit() {</div><div>    this.appService.getData()</div><div>      .subscribe((res:any) =&gt; {</div><div>        console.log(res);</div><div>      });</div><div>  }</div><div>}</div>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":true,"gist":""},{"html":"If you can open developer tools in chrome and go to network tab you will see that a API call was made and in the <b>request-headers</b> section you will see <b>sample-header</b>&nbsp;with value as <b>1</b>. Congratulations! you have implemented Interceptor in Angular 9. Cheers!","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"You can refer the entire project of the above example here in this&nbsp;<a href=\"https://github.com/shadowfalls/interceptors-angular7\" title=\"https://github.com/shadowfalls/interceptors-angular7\" target=\"_blank\">repo</a>","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""},{"html":"","isQuoted":false,"isGist":false,"isMainHeading":false,"isSubHeading":false,"isCodeSection":false,"gist":""}],"date":"2020-01-24T00:00:00.000Z","readTimeMin":"8"}
